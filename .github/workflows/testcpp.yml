on:
  push:
    branches:
      - master
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  testcpp:
    name: Test C++
    runs-on: ubuntu-22.04
    container:
      image: klalumiere/ubuntu-clang:22-14
    strategy:
      matrix:
        buildType: [
          Debug,
          RelWithDebInfo,
        ]
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Prepare environment
        env:
            DEBIAN_FRONTEND: noninteractive
        run: |
          apt-get update
          apt-get install --assume-yes --no-install-recommends libclang-14-dev llvm-14-dev
      - name: Run Tests
        run: |
          cd clang-tidy-plugins
          cmake -DCMAKE_BUILD_TYPE=${{matrix.buildType}} -B ${{matrix.buildType}} -S .
          cmake --build ${{matrix.buildType}}
          ctest
